---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import placeholderImage from '../assets/images/gallery/pinnedpic-1.jpg';

export interface Props {
  post: CollectionEntry<'posts'>;
  featured?: boolean;
  className?: string;
  'aria-labelledby'?: string;
  'data-post-index'?: number;
}

const { post, featured = false, className = '', ...props } = Astro.props;

// Dynamic image resolution with fallback
const coverImage = post.data.cover || placeholderImage;

// Calculate reading time (rough estimate: 200 words per minute)
const calculateReadingTime = (content: string): string => {
  const wordsPerMinute = 200;
  const wordCount = content.trim().split(/\s+/).length;
  const readingTime = Math.ceil(wordCount / wordsPerMinute);
  return `${readingTime} min read`;
};

// Format date
const formatDate = (dateString: string): string => {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

const readingTime = calculateReadingTime(post.body || post.data.description || '');
const formattedDate = formatDate(post.data.date.toString());
---

<article 
  class={`blog-card group ${featured ? 'featured' : ''} ${className} bg-base-100 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden`}
  {...props}
>
  <a 
    href={`/blog/${post.slug}/`}
    class="block h-full focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-base-100 rounded-lg"
    aria-label={`Read article: ${post.data.title}`}
  >
    <!-- Cover Image -->
    <div class="image-container relative overflow-hidden aspect-video">
      <Image
        src={coverImage}
        alt={post.data.cover ? `Cover image for ${post.data.title}` : 'Default cover image'}
        width={800}
        height={450}
        format="webp"
        loading="lazy"
        class="cover-image w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
      />
      
      <!-- Reading time badge -->
      <div class="absolute top-4 right-4 bg-base-100/90 backdrop-blur-sm px-3 py-1 rounded-full text-sm font-medium text-base-content">
        {readingTime}
      </div>
    </div>
    
    <!-- Content -->
    <div class="p-6">
      <!-- Categories/Tags -->
      {post.data.categories && post.data.categories.length > 0 && (
        <div class="mb-3">
          {post.data.categories.slice(0, 2).map((category) => (
            <span class="inline-block bg-primary/10 text-primary px-3 py-1 rounded-full text-sm font-medium mr-2 mb-2">
              {category}
            </span>
          ))}
        </div>
      )}
      
      <!-- Title -->
      <h3 class="text-xl font-bold text-base-content mb-3 group-hover:text-primary transition-colors duration-200 line-clamp-2">
        {post.data.title}
      </h3>
      
      <!-- Description -->
      <p class="text-base-content/70 mb-4 line-clamp-3">
        {post.data.description}
      </p>
      
      <!-- Meta information -->
      <div class="flex items-center justify-between text-sm text-base-content/60">
        <div class="flex items-center space-x-4">
          <!-- Author -->
          <span class="flex items-center">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
            </svg>
            {post.data.author}
          </span>
          
          <!-- Date -->
          <time datetime={post.data.date.toISOString()} class="flex items-center">
            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path>
            </svg>
            {formattedDate}
          </time>
        </div>
        
        <!-- Read more indicator -->
        <span class="text-primary font-medium group-hover:underline">
          Read more â†’
        </span>
      </div>
    </div>
  </a>
</article>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .aspect-video {
    aspect-ratio: 16 / 9;
  }
</style>