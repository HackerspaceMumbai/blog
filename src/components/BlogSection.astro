---
import CTAButton from './CTAButton.astro';
import BlogCard from './BlogCard.astro';
import SectionHeading from './SectionHeading.astro';

const { posts } = Astro.props;

// Validate posts array
const validatedPosts = Array.isArray(posts) ? posts.filter(post => post && post.data && post.data.title) : [];

// Dynamic grid classes based on number of posts
const getGridClasses = (count) => {
  if (count === 1) return 'grid-cols-1 max-w-2xl mx-auto';
  if (count === 2) return 'grid-cols-1 md:grid-cols-2 max-w-4xl mx-auto';
  return 'grid-cols-1 md:grid-cols-2 lg:grid-cols-3';
};

const gridClasses = getGridClasses(validatedPosts.length);
---

<section 
  class="py-20 px-4 bg-base-200"
  aria-labelledby="blog-section-title"
  role="region"
>
  <div class="max-w-7xl mx-auto">
    <!-- Section Header -->
    <header class="mb-16 text-center">
      <SectionHeading 
        id="blog" 
        level={2}
        class="text-3xl font-bold text-primary focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-background rounded-md"
      >
        Latest Blog Posts
      </SectionHeading>
      <p class="mt-4 text-base-content/70 max-w-2xl mx-auto">
        Discover insights, tutorials, and updates from the Hackerspace Mumbai community
      </p>
    </header>
    
    <!-- Blog Posts Grid -->
    {validatedPosts.length > 0 && (
      <div 
        class={`grid ${gridClasses} gap-8 items-start`}
        aria-label={`${validatedPosts.length} blog post${validatedPosts.length === 1 ? '' : 's'} from Hackerspace Mumbai`}
        aria-live="polite"
        aria-busy="false"
      >
        {validatedPosts.map((post, index) => (
          <BlogCard 
            post={post} 
            featured={index === 0}
          />
        ))}
      </div>
    )}
    
    <!-- Empty state for when no posts are available -->
    {validatedPosts.length === 0 && (
      <div 
        class="text-center py-16"
        role="status"
        aria-live="polite"
      >
        <div class="mb-4">
          <svg 
            class="w-16 h-16 mx-auto text-base-content/40" 
            fill="none" 
            stroke="currentColor" 
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 011 1l4 4v9a2 2 0 01-2 2z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 2v4a2 2 0 002 2h4"></path>
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-base-content mb-2">No blog posts available</h3>
        <p class="text-base-content/70">Check back soon for new content from our community!</p>
      </div>
    )}
    
    <!-- CTA Section -->
    <footer class="text-center mt-12">
      <CTAButton 
        href="/blog" 
        variant="soft"
        aria-describedby="view-all-posts-desc"
      >
        View All Posts
      </CTAButton>
      <p 
        id="view-all-posts-desc" 
        class="sr-only"
      >
        Navigate to the complete blog archive to explore all articles from Hackerspace Mumbai
      </p>
    </footer>
  </div>
</section>
