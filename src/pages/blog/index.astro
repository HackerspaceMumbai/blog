---
import Layout from "../../components/Layout.astro";
import BlogCard from "../../components/BlogCard.astro";
import heroBackground from '../../assets/images/hero_background.jpg';
import { getCollection, type CollectionEntry } from "astro:content";

// Get all posts and sort by date (newest first)
const posts: CollectionEntry<'posts'>[] = (await getCollection("posts"))
  .filter(post => post.data.date) // Filter out posts without dates
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

console.log('DEBUG: Posts count:', posts.length);
---

<style>
  .blog-header {
    padding: 3rem 1rem;
    text-align: center;
    margin-bottom: 2rem;
    background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.9)), url('${heroBackground.src}');
    background-size: cover;
    background-position: center;
    border-bottom: 1px solid var(--border);
  }

  .blog-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  .post-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-lg); /* 1.5rem / 24px - gap-6 mobile */
    margin-top: 2rem;
    margin-bottom: var(--space-3xl); /* 4rem / 64px - space before footer */
    align-items: stretch; /* Ensure all cards have equal height */
  }

  @media (min-width: 768px) {
    .post-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-xl); /* 2rem / 32px - gap-8 tablet/desktop */
    }
  }

  @media (min-width: 1024px) {
    .post-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-xl); /* 2rem / 32px - gap-8 desktop */
    }
  }

  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Empty state styling */
  .empty-state {
    grid-column: 1 / -1; /* Span all columns */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 300px;
    padding: 2rem;
    border: 2px dashed var(--border);
    border-radius: var(--rounded-lg);
    background: var(--base-200);
  }

  /* Ensure consistent card heights */
  .post-grid article {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  /* Prevent layout shift during loading */
  .post-grid {
    min-height: 400px; /* Minimum height to prevent layout shift */
  }
</style>

<Layout 
  title="Blog | Hackerspace Mumbai"
  description="Latest articles, tutorials, and news from the Hackerspace Mumbai community."
  type="website"
>
  <!-- Blog Header Section with proper semantic structure -->
  <header class="blog-header" role="banner" aria-labelledby="blog-title">
    <div class="blog-container">
      <h1 id="blog-title" class="text-4xl md:text-5xl font-bold mb-4">
        Hackerspace Mumbai Blog
      </h1>
      <p class="text-xl text-accent opacity-90" role="doc-subtitle">
        Latest articles, tutorials, and insights from our community
      </p>
    </div>
  </header>
  
  <!-- Main Content Area with proper semantic structure -->
  <main class="blog-container" role="main" aria-labelledby="blog-title">
    <!-- Screen reader only heading for context -->
    <h2 class="sr-only">Blog Posts</h2>
    
    <!-- Blog Posts Section -->
    <section 
      class="post-grid" 
      aria-label="Blog posts"
      aria-describedby="blog-description"
    >
      <!-- Hidden description for screen readers -->
      <div id="blog-description" class="sr-only">
        A collection of {posts.length} blog posts from the Hackerspace Mumbai community, 
        sorted by publication date with the most recent posts first.
      </div>
      
      {posts.length === 0 ? (
        <div 
          class="empty-state text-center py-12" 
          role="status" 
          aria-live="polite"
          aria-label="No blog posts available"
        >
          <h3 class="text-2xl font-semibold mb-4">No blog posts available</h3>
          <p class="text-base-content/70 mb-6">
            We're working on creating amazing content for you. Check back soon!
          </p>
          <a 
            href="/contact" 
            class="btn btn-primary"
            aria-label="Contact us to suggest blog topics"
          >
            Suggest a Topic
          </a>
        </div>
      ) : (
        posts.map((post, index) => (
          <BlogCard 
            post={post} 
            data-post-index={index}
            aria-labelledby={`post-${index}-title`}
          />
        ))
      )}
    </section>
    
    <!-- Navigation hint for screen readers -->
    <div class="sr-only" aria-live="polite">
      End of blog posts. Use your browser's back button or the navigation menu to explore other sections.
    </div>
  </main>
</Layout>